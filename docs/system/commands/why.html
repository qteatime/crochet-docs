<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Annex A: Design philosophy" href="../design-philosophy.html" /><link rel="prev" title="Executing commands" href="dispatch.html" />

    <meta name="generator" content="sphinx-4.1.1, furo 2021.07.05.beta38"/>
        <title>Why are commands …? - Crochet 0.12 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/crochet.css" />
    


<style>
  :root {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../_static/pygments_dark.css"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Crochet 0.12 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Crochet 0.12 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">The Crochet System</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../whats-crochet.html">What’s Crochet?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing-crochet.html">Installing Crochet</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../structure/index.html">How is Crochet structured?</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../structure/introduction.html">The Crochet universe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../structure/package-configuration.html">Package configuration</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../types/index.html">Data and types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../types/types-and-data.html">Types and data modelling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../types/using.html">Using typed data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../types/hierarchies.html">Hierarchies of types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../types/traits.html">Traits</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Commands</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="declaration.html">What are commands?</a></li>
<li class="toctree-l3"><a class="reference internal" href="signatures.html">Signatures and their uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="dispatch.html">Executing commands</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Why are commands …?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design-philosophy.html">Annex A: Design philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sociology-and-linguistics.html">Annex B: Sociology and linguistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="why-are-commands">
<h1>Why are commands …?<a class="headerlink" href="#why-are-commands" title="Permalink to this headline">¶</a></h1>
<p>We’ve looked into what commands are and how they work in details, but
<em>why</em> are things the way they are? Why make commands have all of this
complicated “dispatch” business? Why make them global if everything
else in the language isn’t? In this section we discuss some of the design
reasoning behind these decisions.</p>
<div class="section" id="why-do-we-need-this-dispatch-thing">
<h2>Why do we need this “dispatch” thing?<a class="headerlink" href="#why-do-we-need-this-dispatch-thing" title="Permalink to this headline">¶</a></h2>
<p>Most programming languages have functions, and each function has
a name that uniquely identifies it. Mainstream languages have even been
moving towards this direction recently, so Crochet’s idea of
dispatch feels like a complication that goes against the current
trends.</p>
<p>Now, it’s important to keep in mind here that Crochet’s idea of
dispatch <em>is</em> complicated. There’s a lot to learn and keep in mind
here in order to understand what’s happening with commands. In
a language that is security oriented <em>and</em> aimed at people who
are not professional software engineers, there must be a very
good reason to pursue something like this. And this reason must
both offset its complexity and guarantee that this won’t create
a significant amount of security issues.</p>
<p>For Crochet, there are two primary justifications for this. The
first one is that most of the security mechanisms in Crochet
actually rely on this idea of dispatch. The second one is that
Crochet subscribes (and encourages) a philosophy that software
is written collaboratively.</p>
<div class="section" id="dispatch-and-security">
<h3>Dispatch and security<a class="headerlink" href="#dispatch-and-security" title="Permalink to this headline">¶</a></h3>
<p>Crochet relies on a form of Object-Capability Security, but in a way
that’s slightly different from other systems in this space. Crochet
dubs this variation “type capabilities” because of that.</p>
<p>So, in Crochet, what someone can or can’t do is defined by types. In
order to control how much authority a piece of code has—how much you
trust it, and what you’re okay with it doing—you control which types
that piece of code has access to.</p>
<p>You reason about security in terms of types. And you control security
in terms of types—by carefully considering which types you let
people access and which you are not comfortable letting them access.
But are these types used to <em>enforce</em> this idea of security we can
reason about? That’s where commands come in.</p>
<p>Commands are the primary way in Crochet of letting a piece of code
<em>do</em> something. Everything else is really just a form of “configuration”.
It tells us what the system is. It tells us how it’s structured. How we
can think about the different pieces. But we can’t <em>run</em> them. They don’t
really describe any idea of a program behaviour. We need commands to do
things.</p>
<p>Dispatch, then, lets us <em>restrict</em> access to these commands based on
how we’ve restricted access to types—with a bit more of flexibility.
If a command has a requirement on type <code class="docutils literal notranslate"><span class="pre">A</span></code>, and a piece of code has
no way of constructing one, then it has no way of ever using that
command. <code class="docutils literal notranslate"><span class="pre">file-system</span> <span class="pre">file:</span> <span class="pre">SomePath</span></code> can’t be executed if you
have no way of providing an instance of <code class="docutils literal notranslate"><span class="pre">file-system</span></code>.</p>
<p>If we did not have dispatch, we’d have to figure out how to restrict
access to both types <strong>and</strong> commands, and that would require more
effort to make things secure, which is a dangerous thing to do. Security
should be the default, and require little to no effort, if it is to be
adopted extensively by everyone.</p>
<p>We discuss this in more details in the Security and Capabilities chapter.</p>
</div>
<div class="section" id="dispatch-and-collaboration">
<h3>Dispatch and collaboration<a class="headerlink" href="#dispatch-and-collaboration" title="Permalink to this headline">¶</a></h3>
<p>Crochet also assumes that most (if not all) software is created
collaboratively, but this collaboration is more often than not
entirely uncoordinated.</p>
<p>Say Alissa creates a package for rectangles. Later, Max wants to
write a package to handle collisions between objects in a game and
uses Alissa’s rectangle package for bounding boxes. Here, Alissa and
Max are collaborating to create a piece of software, but neither of
them might be aware of what the other is doing!</p>
<p>So, what happens if Max loves everything about Alissa’s rectangles
package. But later in the development of their collision library,
Max notices that a “does this rectangle contain this point” function
would also be useful. In most languages, Max would either:</p>
<ol class="arabic simple">
<li><p>Have to hope Alissa designed with this extension idea in mind—through
subclassing or traits;</p></li>
<li><p>Use some local function for this, which will likely read very differently
from how rectangles and points are used everywhere else; or</p></li>
<li><p>Copy Alissa’s source code and change the package itself.</p></li>
</ol>
<p>Modern languages go for the first one, but that’s problematic in
Crochet’s case because it requires anyone who’s writing a library
to design for extension—and also to predict all cases where
extensions might make sense. This is not a realistic assumption to
make when your target audience is people who are not professional
programmers.</p>
<p>The second one is practical, but the inconsistency makes it
cumbersome, and it’s hard to reason about security properties
in this case.</p>
<p>The third one has a particular problem that is seldomly discussed:
it muddies the boundaries of who owns which part of the code. Alissa
wrote it originally, but Max took over it to shape it into their own
thing. How does Crochet users figure out who they’re trusting? Can
they simply trust Max, even though Max did not write—and might not
have audited—all of the code?</p>
<p>We discuss all of these security implications in details in the
Security and Capabilities chapter. But the important point here
is that Crochet’s choice of dispatch allows Max to write the
function they need, even if Alissa never thought about it,
and still keep it both consistent with the rest of the code,
and consistent with the existing trust boundaries.</p>
</div>
</div>
<div class="section" id="why-are-commands-global">
<h2>Why are commands global?<a class="headerlink" href="#why-are-commands-global" title="Permalink to this headline">¶</a></h2>
<p>Commands in Crochet are always global, unlike other entities in the
language which are qualified by the name of the package defining them.
This might feel particularly surprising if you’re familiar with other
programming languages—there’s a trend to make entities be the exact
opposite, and run as far from global concepts as possible.</p>
<p>There are two reasons behind this: consistency and coherence. And
the drawbacks of doing so are attenuated by the idea of dispatch—which
effectively makes commands “less global” by requiring types to access them.</p>
<div class="section" id="how-are-global-commands-consistent">
<h3>How are global commands consistent?<a class="headerlink" href="#how-are-global-commands-consistent" title="Permalink to this headline">¶</a></h3>
<p>Commands can be defined anywhere. Making them always be global means that,
regardless of where we define them, the way we use a command will always
be the same.</p>
<p>This is a big deal for collaborative programming. We want to make sure that,
if we need to extend things, or if we need to move things around, we don’t
have to change the code to accomodate that. This consistency in definition
and use helps us achieve that.</p>
<p>There are some particularly nuanced implications here for security. On one
hand, this consistency makes it a bit more difficult to reason about provenance—
what exactly am I trusting when I use a command? But it also is required for
some more advanced security mechanisms in Crochet, such as dynamic capabilities.
We discuss this in details in the Security and Capabilities chapter.</p>
</div>
<div class="section" id="how-are-global-commands-coherent">
<h3>How are global commands coherent?<a class="headerlink" href="#how-are-global-commands-coherent" title="Permalink to this headline">¶</a></h3>
<p>Let’s say Taís wrote a small library for interpolating colours when doing
animations. However, Maki also wrote a library to do that. They’re
essentially the same command name, but in two different packages.</p>
<p>If commands were not global, we could have pieces of the code referring to
Taís’ implementation of animations, and pieces of the code referring to
Maki’s implementation. This can be tricky to catch for developers, but
particularly confusing for users—imagine having a computer program that
sometimes behaves in a particular way, but sometimes behaves in a completely
different way.</p>
<p>Coherence means that commands in Crochet must have at most one behaviour
at any point in time. Making commands global is essential to support this—
if we had them be local them we wouldn’t be able to enforce this property
throughout the entire program.</p>
<p>On the other hand, the down side of making things always coherent is that
we would be unable to have both Taís and Maki’s command in the same system.
We’d have to pick one or the other to use everywhere. Crochet deems this
acceptable as it leads to less confusing behaviours in the long run.</p>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../design-philosophy.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Annex A: Design philosophy</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="dispatch.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Executing commands</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Q.
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../_sources/system/commands/why.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Why are commands …?</a><ul>
<li><a class="reference internal" href="#why-do-we-need-this-dispatch-thing">Why do we need this “dispatch” thing?</a><ul>
<li><a class="reference internal" href="#dispatch-and-security">Dispatch and security</a></li>
<li><a class="reference internal" href="#dispatch-and-collaboration">Dispatch and collaboration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#why-are-commands-global">Why are commands global?</a><ul>
<li><a class="reference internal" href="#how-are-global-commands-consistent">How are global commands consistent?</a></li>
<li><a class="reference internal" href="#how-are-global-commands-coherent">How are global commands coherent?</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/main.js"></script>
    </body>
</html>