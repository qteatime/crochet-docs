<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Commands" href="../commands/index.html" /><link rel="prev" title="Types and data modelling" href="types-and-data.html" />

    <meta name="generator" content="sphinx-4.1.1, furo 2021.07.05.beta38"/>
        <title>Using typed data - Crochet 0.12 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css" />
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../_static/pygments_dark.css"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Crochet 0.12 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Crochet 0.12 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">The Crochet System</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../whats-crochet.html">What’s Crochet?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing-crochet.html">Installing Crochet</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../structure/index.html">How is Crochet structured?</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../structure/introduction.html">The Crochet universe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../structure/package-configuration.html">Package configuration</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Data and types</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="types-and-data.html">Types and data modelling</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Using typed data</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../commands/index.html">Commands</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/declaration.html">Commands and program behaviour</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design-philosophy.html">Annex A: Design philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sociology-and-linguistics.html">Annex B: Sociology and linguistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="using-typed-data">
<h1>Using typed data<a class="headerlink" href="#using-typed-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-new-operator">
<span id="new-operator"></span><h2>The <code class="docutils literal notranslate"><span class="pre">new</span></code> operator<a class="headerlink" href="#the-new-operator" title="Permalink to this headline">¶</a></h2>
<p>In order to manipulate data in Crochet it has to be <a class="reference internal" href="types-and-data.html#type-declaration"><span class="std std-ref">typed</span></a>.
And we bring typed data into existence with the <code class="docutils literal notranslate"><span class="pre">new</span></code> operator:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// Given the type
type point2d(x, y);

// We can construct it
new point2d(1, 2);
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are <a class="reference internal" href="types-and-data.html#typed-fields"><span class="std std-ref">fields</span></a> of the type
<code class="docutils literal notranslate"><span class="pre">point2d</span></code>, and the <code class="docutils literal notranslate"><span class="pre">new</span></code> operator binds values to those fields. Hence,
<code class="docutils literal notranslate"><span class="pre">x</span></code> will be bound to <code class="docutils literal notranslate"><span class="pre">1</span></code>, and <code class="docutils literal notranslate"><span class="pre">y</span></code> bound to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
<p>The syntax for the <code class="docutils literal notranslate"><span class="pre">new</span></code> operator is similar to that of the type
declaration, but we put data where the field specifications would go. In
this sense, we call the <code class="docutils literal notranslate"><span class="pre">new</span></code> operator <a class="reference internal" href="../../glossary.html#term-Positional-argument"><span class="xref std std-term">positional</span></a>.
That is, we don’t explicitly tell Crochet which values will be bound to which
fields, but rather that association is done based on the position
that the data and field specifications have in the list.</p>
<p>Here the field <code class="docutils literal notranslate"><span class="pre">x</span></code> is the first one in the type declaration, and the field
<code class="docutils literal notranslate"><span class="pre">y</span></code> is the second one. That’s why the first piece of data, <code class="docutils literal notranslate"><span class="pre">1</span></code> gets bound
to <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<div class="section" id="constructing-capabilities">
<h3>Constructing capabilities<a class="headerlink" href="#constructing-capabilities" title="Permalink to this headline">¶</a></h3>
<p>Because Crochet uses types for capabilities, there are restrictions on
<em>who</em> can construct typed data through the <code class="docutils literal notranslate"><span class="pre">new</span></code> operator. So one can
only use the <a class="reference internal" href="#new-operator"><span class="std std-ref">new operator</span></a> directly if the type
being constructed is defined in the same package as the calling code.</p>
<p>That is, if one were to define a type <code class="docutils literal notranslate"><span class="pre">point2d</span></code> in package A, then
try to construct it in package B, the runtime will prevent this action
because B does not have direct constructing capabilities over types
defined by A. This gives A control over which capabilities it wants
to provide, and how it wants to provide those capabilities.</p>
<p>Capabilities and how exactly Crochet achieves its safety guarantees
is discussed in more details in the Security and Capabilities section.</p>
</div>
</div>
<div class="section" id="projecting-fields">
<span id="field-projection"></span><h2>Projecting fields<a class="headerlink" href="#projecting-fields" title="Permalink to this headline">¶</a></h2>
<p>So typed data consists of several named pieces of data. In order to use a
particular piece of data, we need to project it out. This is done by using
the <code class="docutils literal notranslate"><span class="pre">.</span></code> (dot) operator.</p>
<p>Given a type such as the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type point2d(x, y);
</pre></div>
</div>
<p>And a typed data construct like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let P = new point2d(1, 2);
</pre></div>
</div>
<p>Then we can project fields out of it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>P.x; // ==&gt; 1
</pre></div>
</div>
<div class="section" id="non-existing-fields">
<h3>Non-existing fields<a class="headerlink" href="#non-existing-fields" title="Permalink to this headline">¶</a></h3>
<p>Trying to project a field that does not exist in a typed data is an error,
but this error may not be reported until Crochet tries to execute that
projection. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type point2d(x, y);

let P = new point2d(1, 2);
P.z;
// *** Error: The type point2d does not have a field `z`
//            (known fields: [x, y])
</pre></div>
</div>
</div>
<div class="section" id="fields-and-inheritance">
<h3>Fields and inheritance<a class="headerlink" href="#fields-and-inheritance" title="Permalink to this headline">¶</a></h3>
<p>Types can be described in a hierarchy. Thus, if we have something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type point2d(x, y);
type point3d(a, b, c) is point2d;
</pre></div>
</div>
<p>Then <code class="docutils literal notranslate"><span class="pre">point3d</span></code> can be provided both where <code class="docutils literal notranslate"><span class="pre">point2d</span></code> and <code class="docutils literal notranslate"><span class="pre">point3d</span></code> are
expected. This poses a problem with field projection because <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>
are fields in <code class="docutils literal notranslate"><span class="pre">point2d</span></code>, but they are not fields in <code class="docutils literal notranslate"><span class="pre">point3d</span></code>. Types
do not inherit any data layout from their supertypes in Crochet. This means
that the following would cause very confusing failures:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>command point2d x = self.x;

let P = new point3d(1, 2, 3);
P x;
// *** Error: The type point3d does not have a field `x`
//            (known fields: [a, b, c])
//
//     Arising from:
//       In (point2d) x
//         from module (repl) in crochet.repl.basic
</pre></div>
</div>
<p>For this reason, any command that is meant to be shared with other types
should not use field projection directly, but rather rely on commands whose
only job is to project that field, so the commands can be defined for the
types that need it.</p>
</div>
<div class="section" id="visibility-of-fields">
<h3>Visibility of fields<a class="headerlink" href="#visibility-of-fields" title="Permalink to this headline">¶</a></h3>
<p>Allowing code to project fields from typed data is a dangerous kind of
power. If typed data is to be used for privacy, then arbitrary projection
could very well violate that guarantee, since it’s not necessary to know
the type in order to perform a projection.</p>
<p>To address this, projection of typed data is only possible within the
package that defines the type. This means that any access to the
information inside of a typed data is conditioned to commands instead,
and these follow the expected Crochet guarantees. Users can decide which of
the fields in a typed data can safely be exposed as commands, and what kind
of capabilities are necessary in order to access them.</p>
</div>
</div>
<div class="section" id="projection-with-non-typed-data">
<h2>Projection with non-typed data<a class="headerlink" href="#projection-with-non-typed-data" title="Permalink to this headline">¶</a></h2>
<p>Projection is not restricted to typed data in Crochet. It’s also available
on sequences and records, and it does slightly different things with them.</p>
<div class="section" id="record-projection">
<h3>Record projection<a class="headerlink" href="#record-projection" title="Permalink to this headline">¶</a></h3>
<p>Records are non-typed pieces of data comprised of independent information.
For example, one could represent coordinates as records like so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let Coords = [latitude -&gt; -75.0, longitude -&gt; 31.0];
</pre></div>
</div>
<p>And these pieces of information can be projected like in a typed data:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Coords.latitude; // ==&gt; -75.0
</pre></div>
</div>
<p>Projecting non-existing fields will, likewise, result in an error:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Coords.lat;
// *** Error: The key `lat` does not exist in the record
//            (known keys: latitude, longitude)
</pre></div>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Since records are not typed, they cannot provide any privacy or security
guarantees and should not be used for data that isn’t completely public.</p>
</div>
</div>
<div class="section" id="sequence-projection">
<h3>Sequence projection<a class="headerlink" href="#sequence-projection" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an experimental feature and it’s likely to change!</p>
</div>
<p>Using projection on a sequence, like <code class="docutils literal notranslate"><span class="pre">[A,</span> <span class="pre">B,</span> <span class="pre">C].x</span></code> is equivalent to
projecting each item of the sequence, so the result will be
<code class="docutils literal notranslate"><span class="pre">[A.x,</span> <span class="pre">B.x,</span> <span class="pre">C.x]</span></code>.</p>
<p>For example, given:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let Alice = [name -&gt; "Alice", author -&gt; "Lewis Caroll"];
let Dorothy = [name -&gt; "Dorothy", author -&gt; "L. Frank Baum"];

let Characters = [Alice, Dorothy];
</pre></div>
</div>
<p>If we project the <code class="docutils literal notranslate"><span class="pre">name</span></code> field of this sequence, that’s equivalent to
projecting the <code class="docutils literal notranslate"><span class="pre">name</span></code> field of each record:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Characters.name; // ==&gt; ["Alice", "Dorothy"]
</pre></div>
</div>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../commands/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Commands</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="types-and-data.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Types and data modelling</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Q.
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../_sources/system/types/using.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Using typed data</a><ul>
<li><a class="reference internal" href="#the-new-operator">The <code class="docutils literal notranslate"><span class="pre">new</span></code> operator</a><ul>
<li><a class="reference internal" href="#constructing-capabilities">Constructing capabilities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#projecting-fields">Projecting fields</a><ul>
<li><a class="reference internal" href="#non-existing-fields">Non-existing fields</a></li>
<li><a class="reference internal" href="#fields-and-inheritance">Fields and inheritance</a></li>
<li><a class="reference internal" href="#visibility-of-fields">Visibility of fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#projection-with-non-typed-data">Projection with non-typed data</a><ul>
<li><a class="reference internal" href="#record-projection">Record projection</a></li>
<li><a class="reference internal" href="#sequence-projection">Sequence projection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/main.js"></script>
    </body>
</html>