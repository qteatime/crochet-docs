<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Annex A: Design philosophy" href="../design-philosophy.html" /><link rel="prev" title="Capabilities and groups" href="groups.html" />

    <meta name="generator" content="sphinx-4.1.1, furo 2021.07.05.beta38"/>
        <title>Dynamic capabilities - Crochet 0.12 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/crochet.css" />
    


<style>
  :root {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../_static/pygments_dark.css"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Crochet 0.12 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Crochet 0.12 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">The Crochet System</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../whats-crochet.html">What’s Crochet?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing-crochet.html">Installing Crochet</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../structure/index.html">How is Crochet structured?</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../structure/introduction.html">The Crochet universe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../structure/package-configuration.html">Package configuration</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../types/index.html">Data and types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../types/types-and-data.html">Types and data modelling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../types/hierarchies.html">Hierarchies of types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../types/traits.html">Traits</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../commands/index.html">Commands</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/declaration.html">What are commands?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/signatures.html">Signatures and their uses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/dispatch.html">Executing commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/why.html">Why are commands …?</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../computing/index.html">Computing with Crochet</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../computing/execution-models.html">Execution models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../computing/bindings.html">Naming values</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../computing/intrinsics/index.html">Intrinsic data types</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../computing/intrinsics/gradual.html">Gradual representations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../computing/intrinsics/numbers.html">Numeric models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../computing/intrinsics/text.html">Textual models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../computing/intrinsics/logic.html">Logical models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../computing/intrinsics/functions.html">Program representations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../computing/intrinsics/collections.html">Collections</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../computing/application.html">Applying programs and commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../computing/using.html">Using data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../computing/equality.html">Equality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../computing/branching.html">Branching</a></li>
<li class="toctree-l3"><a class="reference internal" href="../computing/comprehension.html">Working with multiple values</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../effects/index.html">Effects</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../effects/what-are-effects.html">What are effects?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../effects/handlers.html">Effect handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../effects/contexts.html">Contextual handlers</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../verification/index.html">Verification</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../verification/examples.html">Example-based testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../verification/contracts.html">Contracts</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../ffi/index.html">Foreign interfaces</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../ffi/interface.html">Writing external functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ffi/ffi.html">The FFI type</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Security and capabilities</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="why.html">Why use capabilities?</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html">Capabilities and groups</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Dynamic capabilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design-philosophy.html">Annex A: Design philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sociology-and-linguistics.html">Annex B: Sociology and linguistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="dynamic-capabilities">
<h1>Dynamic capabilities<a class="headerlink" href="#dynamic-capabilities" title="Permalink to this headline">¶</a></h1>
<p>Crochet’s push for Types as Capabilities has the primary goal of
making it possible for tools to help people understand the risks
they are taking by running programs in their computer. Their static
nature is what allows that—but this comes with its own problems.</p>
<div class="section" id="why-do-we-need-them">
<h2>Why do we need them?<a class="headerlink" href="#why-do-we-need-them" title="Permalink to this headline">¶</a></h2>
<p>When everything is static it means that you both need to grant
all of the capabilities ahead of the time, and that you can never
take back the capabilities after you grant them. And that poses
both security and usability issues.</p>
<p>To address this, Crochet also allows capabilities to be dynamically
granted—that is, granted while the program is running, rather than
before running it. This is necessary for contextual capabilities
(a future extension to Crochet’s capability system necessary for
usability), and also for giving packages control over temporary,
restricted, and revocable capabilities.</p>
<p>For example, consider the case where we’ve asked the user to choose
a directory on their computer to save novels that our application
can generate. We then want to allow the package that handles the
novels to read and write to this directory (and <em>nothing else</em>),
but only if the user has given us this power—the user might simply
not wish to save the novels, and thus should never be even bothered
with being asked for this power; the user should not be made aware
that this specific Crochet capability exists until the application
needs it.</p>
<p>Static capabilities cannot solve this problem because they would
both make the user aware of the power before running the program,
and would never be aware of which directories could be chosen by
the user—after all, that is something the user decides <em>while</em>
running the program, not before running it.</p>
</div>
<div class="section" id="objects-as-capabilities">
<h2>Objects as capabilities<a class="headerlink" href="#objects-as-capabilities" title="Permalink to this headline">¶</a></h2>
<p>By using Types as capabilities, Crochet allows us to reason about
powers and risks. And then it allows us to control how this power
is distributed in the program configuration—who gets access to
what.</p>
<p>But once the program is configured, what powers are effectively
used is determined by Commands. And these commands are selected
by types in principle—but they don’t <em>receive</em> types, they
receive objects; the little pieces of information that we get
from Constructing a type.</p>
<p>And this idea of Commands that are selected by Objects is core
to languages that use objects as capabilities. If you can get
your hands on an object, then you’ve gotten the power to its
commands as well. And because these objects flow through the
program in arguments to commands, or as return values from
various operations, we’re no longer restricted to powers
that the configuration dictates; but powers that the execution
of the program chooses to grant.</p>
<p>For example, if we continue with our opening problem in this
chapter—that of a program that lets users save novels to a
directory of their choosing (and nothing else), then we could
have a powerful package that handles asking the user for this
directory:</p>
<div class="highlight-crochet notranslate"><div class="highlight"><pre><span></span><span class="k">command</span> game ask-storage-directory <span class="o">-&gt;</span> directory <span class="k">do</span>
  <span class="c1">// Implementation intentionally omitted</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The implementation of this command isn’t too relevant, but it
returns a <code class="docutils literal notranslate"><span class="pre">directory</span></code> object. This <code class="docutils literal notranslate"><span class="pre">directory</span></code> object would
then give one powers to read files and save files in that directory
alone—without even being made aware that other files and directories
exist.</p>
<p>We can then pass this object around until it reaches the other
package that generates novels. This package has no powers from its
configuration, but it’s able to accept directories and use them:</p>
<div class="highlight-crochet notranslate"><div class="highlight"><pre><span></span><span class="k">command</span> novel <span class="nf">save-to:</span> <span class="p">(</span><span class="nv">Directory</span> <span class="k">is</span> directory<span class="p">)</span> <span class="k">do</span>
  <span class="k">let</span> <span class="nv">File</span> <span class="p">=</span> <span class="nv">Directory</span> <span class="nf">create-file:</span> <span class="k">self</span> title<span class="p">;</span>
  <span class="nv">File</span> <span class="nf">write-text:</span> <span class="k">self</span> contents<span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Here we’re able to create a file inside of the directory, and write
to that file. But that’s all we can do. We can’t break out of this
directory and access other files—or modify other files. Indeed,
we can’t even be sure that this directory is an <em>actual</em> directory
in the computer. It could be a Zip archive. It could be a database.
It could be a storage service that is accessed through the internet.
As long as the expected semantics are the same, the user of this
object cannot know its true form, and it should not care.</p>
<div class="section" id="revocable-capabilities">
<h3>Revocable capabilities<a class="headerlink" href="#revocable-capabilities" title="Permalink to this headline">¶</a></h3>
<p>A revocable capability is an object capability that can stop working
at the convenience of whoever granted it. For example, if we wished
to grant some piece of code a one-use capability for saving data,
we could do so by making an object that exposes commands which only
work once. This could be achieved by using cells:</p>
<div class="highlight-crochet notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> save-once<span class="p">(</span>used <span class="k">is</span> cell<span class="o">&lt;</span>boolean<span class="o">&gt;</span><span class="p">);</span>

<span class="k">command</span> <span class="o">#</span>save-once make <span class="p">=</span> <span class="k">new</span> save-once<span class="p">(</span><span class="o">#</span>cell <span class="nf">with-value:</span> <span class="k">false</span><span class="p">);</span>

<span class="k">command</span> save-once <span class="nf">save:</span> <span class="nv">Data</span>
<span class="k">requires</span> not-used <span class="p">::</span> <span class="k">not</span> <span class="p">(</span>self.used value<span class="p">)</span>
<span class="k">do</span>
  <span class="c1">// Implementation of saving the data goes here</span>
  self.used <span class="o">&lt;-</span> <span class="k">true</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Here the usage of the command <code class="docutils literal notranslate"><span class="pre">_</span> <span class="pre">save:</span> <span class="pre">_</span></code> is guarded by the <code class="docutils literal notranslate"><span class="pre">not-used</span></code>
contract, which makes sure that the <code class="docutils literal notranslate"><span class="pre">used</span></code> field is false. When we save
the data, we mark this <code class="docutils literal notranslate"><span class="pre">used</span></code> field as true, consequently making the
<code class="docutils literal notranslate"><span class="pre">_</span> <span class="pre">save:</span> <span class="pre">_</span></code> command unusable from there on.</p>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../design-philosophy.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Annex A: Design philosophy</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="groups.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Capabilities and groups</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Q.
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../_sources/system/security/dynamic.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Dynamic capabilities</a><ul>
<li><a class="reference internal" href="#why-do-we-need-them">Why do we need them?</a></li>
<li><a class="reference internal" href="#objects-as-capabilities">Objects as capabilities</a><ul>
<li><a class="reference internal" href="#revocable-capabilities">Revocable capabilities</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/main.js"></script>
    </body>
</html>