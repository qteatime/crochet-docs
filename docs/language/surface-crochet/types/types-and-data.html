<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="3.2. Using typed data" href="using.html" /><link rel="prev" title="3. Data and types" href="index.html" />

    <meta name="generator" content="sphinx-4.1.1, furo 2021.07.05.beta38"/>
        <title>3.1. Types and data modelling - Crochet 0.9.x documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css" />
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Crochet 0.9.x documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">Crochet 0.9.x documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">The Crochet languages</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">Surface Crochet</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../design-philosophy.html">1. Design philosophy</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../structure/index.html">2. Structuring programs</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../structure/introduction.html">2.1. The Crochet universe</a></li>
</ul>
</li>
<li class="toctree-l3 current has-children"><a class="reference internal" href="index.html">3. Data and types</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l4 current current-page"><a class="current reference internal" href="#">3.1. Types and data modelling</a></li>
<li class="toctree-l4"><a class="reference internal" href="using.html">3.2. Using typed data</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../commands/index.html">4. Commands</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../commands/declaration.html">4.1. Commands and program behaviour</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../annexes/sociology-and-linguistics.html">5. Annex A: Sociology and linguistics</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="types-and-data-modelling">
<h1><span class="section-number">3.1. </span>Types and data modelling<a class="headerlink" href="#types-and-data-modelling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-are-types">
<span id="id1"></span><h2><span class="section-number">3.1.1. </span>What are types?<a class="headerlink" href="#what-are-types" title="Permalink to this headline">¶</a></h2>
<p>A type is primarily a way of classifying data. For example, a number like
<code class="docutils literal notranslate"><span class="pre">1</span></code> is classified as an integer. A piece of text like <code class="docutils literal notranslate"><span class="pre">"hello"</span></code>
may be classified as a text. A value like <code class="docutils literal notranslate"><span class="pre">true</span></code> can be classified
as boolean.</p>
<p>Crochet uses these classifications both to talk about data in a more
general way—making it a tool for people to communicate with others—,
and also a tool to define what can and can’t be done to pieces of
data. That makes types double as a privacy and security feature as
well.</p>
<p>This means that, in Crochet, a “type” is:</p>
<ul class="simple">
<li><p><strong>A way of granting Dynamic Capabilities</strong> —
Types are the sole grantors of dynamic capabilities. What a piece of code
can do depends entirely on which types it has access to, and what it can
do with those types.</p></li>
<li><p><strong>A way of doing Dispatch</strong> —
Crochet’s <a class="reference internal" href="../commands/index.html#commands"><span class="std std-ref">Commands</span></a> are a collection of different functions, and the
runtime uses types to select which one of these functions should be
executed for some given arguments. <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">+</span> <span class="pre">B</span></code> may do very different
things depending on what the types of <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> are.</p></li>
<li><p><strong>A way of classifying and securing data</strong> —
Crochet’s types are also Runtime Tags, and they provide a way to
classify and secure data at runtime.</p></li>
</ul>
</div>
<div class="section" id="type-declarations-and-usage">
<span id="type-declaration"></span><h2><span class="section-number">3.1.2. </span>Type declarations and usage<a class="headerlink" href="#type-declarations-and-usage" title="Permalink to this headline">¶</a></h2>
<p>A type declaration provides a name for a particular combination of data.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type point2d(x, y);
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">point2d</span></code> is a name that will be associated with a combination
of data that contains <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> points. Here, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are
also called <a class="reference internal" href="#typed-fields"><span class="std std-ref">fields</span></a>. Association is done through the <a class="reference internal" href="using.html#new-operator"><span class="std std-ref">new operator</span></a>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>new point2d(1, 2);
</pre></div>
</div>
<p>Will associate the name <code class="docutils literal notranslate"><span class="pre">point2d</span></code> with the data points <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">1</span></code> and
<code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">2</span></code>. Important to Crochet’s security guarantees is that this
name association is unforgeable. One must know and have power over
the <code class="docutils literal notranslate"><span class="pre">point2d</span></code> declaration in order to associate it with data points.</p>
<p>Once a piece of data is associated with a name, specific fields of
this data can be projected with the dot operator:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let P = new point2d(1, 2);
assert P.x ==&gt; 1;
assert P.y ==&gt; 2;
</pre></div>
</div>
<p><a class="reference internal" href="using.html#field-projection"><span class="std std-ref">Field projection</span></a> is very restricted for security reasons, and typed
data is really mostly operated (and observed) through <a class="reference internal" href="../commands/index.html#commands"><span class="std std-ref">commands</span></a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>What constitutes a valid spelling of a type name in Crochet is
very restricted. The section on the <a class="reference internal" href="../annexes/sociology-and-linguistics.html#lexical-restriction-names"><span class="std std-ref">lexical restriction of names</span></a>
discusses this in details.</p>
</div>
</div>
<div class="section" id="fields-of-typed-data">
<span id="typed-fields"></span><h2><span class="section-number">3.1.3. </span>Fields of typed data<a class="headerlink" href="#fields-of-typed-data" title="Permalink to this headline">¶</a></h2>
<p>Typed data consists of an unique, unforgeable name (the type) and a set of
fields. Each field is a named piece of data, bound at the time it’s constructed,
and unchangeable henceafter. That is, unlike many object-oriented languages,
all fields in Crochet are effectively <a class="reference internal" href="../../../glossary.html#term-Immutable-data"><span class="xref std std-term">immutable</span></a>.</p>
<p>Although fields describe what some kind of “shape” for the data—that is,
what the typed data is constituted of—, fields don’t really determine
how Crochet stores this data in a computer. The internal layout
of a piece of typed data is a bit more complicated, and subject to constant
changes.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>What constitutes a valid spelling of a field name in Crochet is
very restricted. The section on the <a class="reference internal" href="../annexes/sociology-and-linguistics.html#lexical-restriction-names"><span class="std std-ref">lexical restriction of names</span></a>
discusses this in details.</p>
</div>
<div class="section" id="global-fields">
<h3><span class="section-number">3.1.3.1. </span>Global fields<a class="headerlink" href="#global-fields" title="Permalink to this headline">¶</a></h3>
<p>Because fields may carry very sensitive pieces of data, by default they’re
restricted and can only be accessed within the package that declared the
type. In order to make them accessible outside of the package, one needs
to expose them through a <a class="reference internal" href="../commands/index.html#commands"><span class="std std-ref">command</span></a>.</p>
<p>Some types have very trivial patterns for accessing their fields, however.
For example, if we have:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type point2d(x, y);
</pre></div>
</div>
<p>Then we don’t really want to do anything before providing the values stored
in <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> to whoever needs them. So we’d essentially be writing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type point2d(x, y);
command point2d x = self.x;
command point2d y = self.y;
</pre></div>
</div>
<p>In these cases, we can mark the field as “global” and Crochet will generate
the command definitions above for us. So the following is equivalent, but
takes less effort:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type point2d(global x, global y);
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-less-types">
<h2><span class="section-number">3.1.4. </span>Data-less types<a class="headerlink" href="#data-less-types" title="Permalink to this headline">¶</a></h2>
<p>Types are often associated with pieces of data to control how we can
observe and operate on them, but they’re not <em>always</em> associated with
a piece of data. For example, types like <code class="docutils literal notranslate"><span class="pre">nothing</span></code> stand on their
own, they don’t need to be associated with anything else.</p>
<p>A data-less type declaration looks much like what we’ve seen previously,
but no fields are specified:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type some-name;
</pre></div>
</div>
<p>The <a class="reference internal" href="using.html#new-operator"><span class="std std-ref">new operator</span></a> is still what brings these types to the realm of
data—but there’s no data to associate with the name. Data-less types
are, instead, used to build unforgeable and unique names. These names
can have many usages. For example, these names can act as a way to
identify related data: if you’re building a game, characters may be
data-less types whose actual data is stored elsewhere, like in
Crochet’s database. They are also often used to define modules,
or as a secure capability.</p>
<p>However one decides to use them, construction is similar, but again
without providing any field bindings:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>new some-name;
</pre></div>
</div>
</div>
<div class="section" id="singleton-types">
<h2><span class="section-number">3.1.5. </span>Singleton types<a class="headerlink" href="#singleton-types" title="Permalink to this headline">¶</a></h2>
<p>A special form of a data-less type is one where we don’t really want
to construct multiple unique names. Rather, we want to have one name
that is unique and unforgeable. modules often fall in this category,
but so do a lot of the other cases mentioned previously. For example,
if you’re building a game, and you’re using a data-less type for a
main character, you don’t really want to have <em>multiple</em> unique copies
of that character.</p>
<p>Crochet provides a special type declaration for this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singleton player;
</pre></div>
</div>
<p>In this case we don’t use the <a class="reference internal" href="using.html#new-operator"><span class="std std-ref">new operator</span></a> for materialising the
name <code class="docutils literal notranslate"><span class="pre">player</span></code>—it’s already part of the <code class="docutils literal notranslate"><span class="pre">singleton</span></code> declaration.
It will construct a global name <code class="docutils literal notranslate"><span class="pre">player</span></code> that is unique.</p>
<p>Indeed, the singleton declaration works much like the following
piece of Crochet:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// Introduces a new data-less type definition, `player`.
type player;

// Constructs an unique `player` name, allows it to be accessed through
// the global `player` variable.
define player = new player;

// Forbids any further construction of `player` names.
seal player;
</pre></div>
</div>
<p>The seal operation at the end ensures that the system has exactly
one <code class="docutils literal notranslate"><span class="pre">player</span></code> name, by forbiding any future uses of the <a class="reference internal" href="using.html#new-operator"><span class="std std-ref">new operator</span></a>
for this type. This guarantee is useful when using these names as keys
(e.g.: when using them as keys in the Crochet database), as it
eliminates the potential for confusion when copies of the name
are created accidentally.</p>
</div>
<div class="section" id="types-as-possibilities">
<h2><span class="section-number">3.1.6. </span>Types as possibilities<a class="headerlink" href="#types-as-possibilities" title="Permalink to this headline">¶</a></h2>
<p>There’s one more data modelling aspect that is not covered by the previous
type declarations. Consider the case where we want to talk about
mathematical shapes. Sure we can just define each shape independently:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type square(side);
type circle(radius);
type triangle(adjacent, opposite, hypotenuse);
</pre></div>
</div>
<p>But these independent definitions obscure that all of them share some
commonality; all of them are shapes. It gives us no language to talk
about shapes, in general, only particular shapes.</p>
<p>To address this, Crochet uses subtyping relationships. That is, types
are placed into a hierarchy, and types that are higher in the
hierarchy can be used to talk about some commonalities of the
types below them.</p>
<p>In this case, we could introduce a <code class="docutils literal notranslate"><span class="pre">shape</span></code> type that sits atop of
these specific shapes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type shape;
type square(side) is shape;
type circle(radius) is shape;
type triangle(adjacent, opposite, hypotenuse) is shape;
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">shape</span></code> attached at the end of the previous type declarations.
It denotes that each of these individual shapes can also be understood as
a <code class="docutils literal notranslate"><span class="pre">shape</span></code>. A <a class="reference internal" href="../commands/index.html#commands"><span class="std std-ref">command</span></a> that accepts <code class="docutils literal notranslate"><span class="pre">shape``s</span> <span class="pre">will</span> <span class="pre">accept</span> <span class="pre">any</span> <span class="pre">of</span> <span class="pre">the</span>
<span class="pre">specific</span> <span class="pre">ones,</span> <span class="pre">as</span> <span class="pre">well</span> <span class="pre">as</span> <span class="pre">``shape</span></code> itself.</p>
<div class="section" id="caveats-of-a-static-hierarchy">
<h3><span class="section-number">3.1.6.1. </span>Caveats of a static hierarchy<a class="headerlink" href="#caveats-of-a-static-hierarchy" title="Permalink to this headline">¶</a></h3>
<p>It’s important to note that Crochet admits only one static hierarchy. This
is discussed at length in the subtyping and hierarchy section. But it
means that this feature is a poor fit for <em>contextual</em> hierarchies. For
example, still in the theme of mathematical shapes, one may think that
a <code class="docutils literal notranslate"><span class="pre">square</span></code> would be just a special case of a <code class="docutils literal notranslate"><span class="pre">rectangle</span></code>, and they
may proceed to define the following hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type rectangle(width, height) is shape;
type square(side) is rectangle;
</pre></div>
</div>
<p>You might think that this makes sense, but we run into things like the
following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>let A = new rectangle(10, 10);
let B = new square(10);
</pre></div>
</div>
<p>Now, both <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> are mathematically equivalent shapes—they’re
both squares with sides of length 10. But Crochet’s type system does not
know that a square means “all sides have equal length”, it only knows that
rectangles have a <code class="docutils literal notranslate"><span class="pre">width</span></code> and <code class="docutils literal notranslate"><span class="pre">height</span></code> component, and squares, which
are a kind of rectangle, only have a <code class="docutils literal notranslate"><span class="pre">side</span></code> component. Therefore the
type system does not consider <code class="docutils literal notranslate"><span class="pre">A</span></code> to be a square—even though we,
humans, do.</p>
<p>So, as a rule of thumb, it’s better to make subtypes only if they
unconditionally fulfill all of the properties of its parent type. Such
principle is often described as the Liskov substution principle.</p>
</div>
<div class="section" id="caveats-of-an-open-hierarchy">
<h3><span class="section-number">3.1.6.2. </span>Caveats of an open hierarchy<a class="headerlink" href="#caveats-of-an-open-hierarchy" title="Permalink to this headline">¶</a></h3>
<p>It’s important to note as well that hierarchies in Crochet are <strong>open</strong>.
This—and its implications—is discussed at length in the
subtyping and hierarchy section. But it means that new types may
be added to the hierarchy at any point in time, by anyone.</p>
<p>For example, consider the case where one is modelling an RPG system
where characters may be affected by different conditions. This will
often be defined as an hierarchy, so we can talk about <em>conditions</em>
in general, as well as specific conditions:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type condition;
type poisoned is condition;
type sleeping is condition;
type silenced is condition;
</pre></div>
</div>
<p>As it stands, the author of the <code class="docutils literal notranslate"><span class="pre">condition</span></code> type has thought of
three different conditions: <code class="docutils literal notranslate"><span class="pre">poisoned</span></code>, <code class="docutils literal notranslate"><span class="pre">sleeping</span></code>, and <code class="docutils literal notranslate"><span class="pre">silenced</span></code>.
It’s quite likely that the code dealing with conditions may end up
baking assumptions about its specific conditions. However, there is
nothing in Crochet that prevents some other piece of code from
attaching more conditions to this hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type petrified is condition;
</pre></div>
</div>
<p>If such a declaration appears at some later point, somewhere in the
program, then <code class="docutils literal notranslate"><span class="pre">petrified</span></code> will be considered as much as a member
of the <code class="docutils literal notranslate"><span class="pre">condition</span></code> hierarchy as any other. These declarations may,
indeed, happen when the program is executing—through the
Crochet interactive playground.</p>
<p>In order to add new types to the hierarchy, however, an author would
need to have access to the <code class="docutils literal notranslate"><span class="pre">condition</span></code> type. So limiting the visibility
of this type would allow more control over the hierarchy. But the
open and extensible behaviour is often more desirable if you’re
sharing your code with someone else.</p>
</div>
<div class="section" id="caveats-of-field-projection">
<h3><span class="section-number">3.1.6.3. </span>Caveats of field projection<a class="headerlink" href="#caveats-of-field-projection" title="Permalink to this headline">¶</a></h3>
<p>Often programming languages that feature type hierarchies also have
subtypes inherit the fields from the parent type. That is, given
something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type rectangle(width, height);
type square(side) is rectangle;
</pre></div>
</div>
<p>Then, in common object-oriented languages, the <code class="docutils literal notranslate"><span class="pre">square</span></code> type would really
define three fields: <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code>, and <code class="docutils literal notranslate"><span class="pre">side</span></code>. Where the first two
would be inherited from <code class="docutils literal notranslate"><span class="pre">rectangle</span></code>.</p>
<p>Crochet does not work that way. In Crochet, there is no field inheritance.
The layout of a data structure is precisely what is specified in its
declaration. Commands, however, are inherited, and thus it is important
for inherited commands to not use field projection directly.</p>
<p>This is discussed at length in the subtyping and hierarchy section.</p>
</div>
</div>
<div class="section" id="abstract-types">
<h2><span class="section-number">3.1.7. </span>Abstract types<a class="headerlink" href="#abstract-types" title="Permalink to this headline">¶</a></h2>
<p>Types that exist only to denote an hierarchy are often not really <em>useful</em>
to construct. For example, in our previous examples with the <code class="docutils literal notranslate"><span class="pre">shape</span></code> and
<code class="docutils literal notranslate"><span class="pre">condition</span></code> types, there aren’t really use cases for constructing them.
Crochet makes it possible to make this explicit through the <code class="docutils literal notranslate"><span class="pre">abstract</span></code>
declaration:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>abstract shape;
type square(side) is shape;
type circle(radius) is shape;
type triangle(adjacent, opposite, hypotenuse) is shape;
</pre></div>
</div>
<p>Here the only thing that has changed is the declaration of the <code class="docutils literal notranslate"><span class="pre">shape</span></code>
type, replacing the <code class="docutils literal notranslate"><span class="pre">type</span></code> keyword with the <code class="docutils literal notranslate"><span class="pre">abstract</span></code> one. The
semantics of the <code class="docutils literal notranslate"><span class="pre">shape</span></code> type (and any of its subtypes) remain largely
unchanged, but this means that the <a class="reference internal" href="using.html#new-operator"><span class="std std-ref">new operator</span></a> will not work on
<code class="docutils literal notranslate"><span class="pre">shape</span></code> itself:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>new shape;
// *** Error: non-constructable: `shape` is an abstract type;
//                                it cannot be constructed.
</pre></div>
</div>
</div>
<div class="section" id="enumeration-types">
<h2><span class="section-number">3.1.8. </span>Enumeration types<a class="headerlink" href="#enumeration-types" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you want an hierarchy of names, just like the example of
modelling a <code class="docutils literal notranslate"><span class="pre">condition</span></code> hierarchy for an RPG earlier in this
page. The specific subtypes don’t really need to hold any data,
but you’d like to differentiate each case.</p>
<p>While it’s possible to just provide all cases one by one, using
the <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">&lt;parent</span> <span class="pre">type&gt;</span></code> notation, Crochet provides a more
convenient way of declaring these hierarchies; called an
enumeration.</p>
<p>Enumerations in Crochet can be declared as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>enum condition = poisoned, sleeping, silenced;
</pre></div>
</div>
<p>The effect is similar to the following way of declaring the same:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>abstract condition;
singleton poisoned is condition;
singleton sleeping is condition;
singleton silenced is condition;
close condition;
</pre></div>
</div>
<p>However, enumerations are closed hierarchies, meaning that it is not
possible to add new names to the hierarchy somewhere else in the code.
All possibilities must be provided at the exact place where the enumeration
is declared.</p>
<p>Enumerations make use of this additional restriction to provide some
out-of-the-box functionality. For example, enumerations are <em>ordered</em>,
which makes them useful for modelling a set of progressive states—or
steps:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>enum health = healthy, scratched, bleeding, dead;
</pre></div>
</div>
<p>In a game that features combat and tracks the health of characters without
using numbers, the above would offer a possibility of using pre-built
commands, such as <code class="docutils literal notranslate"><span class="pre">healthy</span> <span class="pre">successor</span></code> to move a character who just
took some damage to the <code class="docutils literal notranslate"><span class="pre">scratched</span></code> state.</p>
<p>See the Enumerations page for a lengthy discussion on these built-in
conveniences.</p>
</div>
<div class="section" id="static-types">
<h2><span class="section-number">3.1.9. </span>Static types<a class="headerlink" href="#static-types" title="Permalink to this headline">¶</a></h2>
<p>We’ve seen how types are unique, unforgeable names that can be associated
with a piece of data (or with nothing, in the case of data-less types).
When one constructs a type through the <a class="reference internal" href="using.html#new-operator"><span class="std std-ref">new operator</span></a>, we get an
unique piece of data. But until we do so, types don’t really play in
the same field data does—types are entirely separated entities,
operated on only through <code class="docutils literal notranslate"><span class="pre">type</span></code> declarations.</p>
<p>This creates some awkward problems, however. For example, consider
integral numbers, such as <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2022</span></code>. In Crochet, these are
all associated with the integer type. And when we define <a class="reference internal" href="../commands/index.html#commands"><span class="std std-ref">commands</span></a>
on this integer type, we only accept actual integral numbers in them.
For example, <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code> is integral addition, but <code class="docutils literal notranslate"><span class="pre">integer</span> <span class="pre">+</span> <span class="pre">integer</span></code>
is not even valid Crochet code, because types cannot appear there.
What, then, should a command about integers look like when you don’t
have an actual number to provide, because the command is responsible
for producing them?</p>
<p>To be more concrete, consider the case of taking a textual
representation of integral numbers, such as <code class="docutils literal notranslate"><span class="pre">"one"</span></code>, and producing
the equivalent integer—which in this case would be <code class="docutils literal notranslate"><span class="pre">1</span></code>. A language
may be tempted to define a command on pieces of text, such as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>command text to-integer = // implementation goes here
</pre></div>
</div>
<p>But command names in Crochet are neither unique nor unforgeable. We
may have two different people introducing an <code class="docutils literal notranslate"><span class="pre">integer</span></code> type and
that will result in two distinct types. Commands don’t allow this.
Naming two commands <code class="docutils literal notranslate"><span class="pre">to-integer</span></code> just means that you need to
pick which one will be used; you can’t have both. And this runs
against all of the security guarantees that Crochet relies on.</p>
<p>So, instead, Crochet has a special notation for using types without
constructing them. When directly turning types into data, the resulting
data is going to be associated with a <em>static type</em>—a special version
of the type, with the same name, but which isn’t part of any hierarchy.</p>
<p>Types are turned into static data by prefixing their name with <code class="docutils literal notranslate"><span class="pre">#</span></code>. It
means the special static type when in a type context, and the unique
static data when in a data context. So, if we were to write a more secure
version of the previous command, we could do as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>command text to: #integer = // implementation goes here
</pre></div>
</div>
<p>And this would be used like so: <code class="docutils literal notranslate"><span class="pre">"one"</span> <span class="pre">to:</span> <span class="pre">#integer</span></code>, resulting in <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>Indeed, these conversion cases are common enough that Crochet has the
command <code class="docutils literal notranslate"><span class="pre">_</span> <span class="pre">as</span> <span class="pre">_</span></code> in the standard library.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Static types are very limited. They cannot be used in <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">&lt;parent&gt;</span></code>
relationships, and they do not have any further static types. That is,
something like <code class="docutils literal notranslate"><span class="pre">##integer</span></code> (the static type of the static type of integer)
is not a valid piece of code in Crochet.</p>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="using.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">3.2. </span>Using typed data</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">3. </span>Data and types</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Q.
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../../_sources/language/surface-crochet/types/types-and-data.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">3.1. Types and data modelling</a><ul>
<li><a class="reference internal" href="#what-are-types">3.1.1. What are types?</a></li>
<li><a class="reference internal" href="#type-declarations-and-usage">3.1.2. Type declarations and usage</a></li>
<li><a class="reference internal" href="#fields-of-typed-data">3.1.3. Fields of typed data</a><ul>
<li><a class="reference internal" href="#global-fields">3.1.3.1. Global fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-less-types">3.1.4. Data-less types</a></li>
<li><a class="reference internal" href="#singleton-types">3.1.5. Singleton types</a></li>
<li><a class="reference internal" href="#types-as-possibilities">3.1.6. Types as possibilities</a><ul>
<li><a class="reference internal" href="#caveats-of-a-static-hierarchy">3.1.6.1. Caveats of a static hierarchy</a></li>
<li><a class="reference internal" href="#caveats-of-an-open-hierarchy">3.1.6.2. Caveats of an open hierarchy</a></li>
<li><a class="reference internal" href="#caveats-of-field-projection">3.1.6.3. Caveats of field projection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#abstract-types">3.1.7. Abstract types</a></li>
<li><a class="reference internal" href="#enumeration-types">3.1.8. Enumeration types</a></li>
<li><a class="reference internal" href="#static-types">3.1.9. Static types</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/scripts/main.js"></script>
    </body>
</html>